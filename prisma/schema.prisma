generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Tenant {
  id            String         @id @default(cuid())
  name          String
  currency      String         @default("USD")
  taxRate       Float          @default(0)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  categories    Category[]
  products      Product[]
  sales         Sale[]
  subscriptions Subscription[]
  users         User[]

  @@index([name])
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  role      UserRole @default(ADMIN)
  tenantId  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  name      String?
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
}

model Subscription {
  id        String           @id @default(cuid())
  plan      SubscriptionPlan @default(BASIC)
  isActive  Boolean          @default(true)
  startsAt  DateTime         @default(now())
  expiresAt DateTime
  createdAt DateTime         @default(now())
  tenantId  String
  tenant    Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([expiresAt])
}

model Category {
  id        String    @id @default(cuid())
  name      String
  tenantId  String
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  tenant    Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  products  Product[]

  @@unique([tenantId, name])
  @@index([tenantId])
}

model Product {
  id                String     @id @default(cuid())
  name              String
  sku               String
  price             Decimal    @db.Decimal(10, 2)
  stock             Int
  lowStockThreshold Int        @default(5)
  tenantId          String
  categoryId        String?
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt
  cost              Decimal    @default(0) @db.Decimal(10, 2)
  category          Category?  @relation(fields: [categoryId], references: [id])
  tenant            Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  saleItems         SaleItem[]

  @@unique([tenantId, sku])
  @@index([tenantId])
  @@index([sku])
}

model Sale {
  id             String        @id @default(cuid())
  invoiceNumber  String
  subtotal       Decimal       @db.Decimal(12, 2)
  discountAmount Decimal       @db.Decimal(12, 2)
  taxAmount      Decimal       @db.Decimal(12, 2)
  totalAmount    Decimal       @db.Decimal(12, 2)
  paymentMethod  PaymentMethod
  tenantId       String
  createdAt      DateTime      @default(now())
  tenant         Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  items          SaleItem[]

  @@unique([tenantId, invoiceNumber])
  @@index([tenantId])
  @@index([createdAt])
}

model SaleItem {
  id         String  @id @default(cuid())
  saleId     String
  productId  String
  quantity   Int
  unitPrice  Decimal @db.Decimal(10, 2)
  totalPrice Decimal @db.Decimal(12, 2)
  product    Product @relation(fields: [productId], references: [id])
  sale       Sale    @relation(fields: [saleId], references: [id], onDelete: Cascade)

  @@index([saleId])
  @@index([productId])
}

enum UserRole {
  ADMIN
}

enum PaymentMethod {
  CASH
  CARD
}

enum SubscriptionPlan {
  BASIC
  TRIAL
  PRO
}
